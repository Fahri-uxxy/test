--[[ 
    PREMIUM AUTO SOUL SCYTHE - V2 (FIXED LOADING)
    Developer: Fahri/xenavenezue
    Fitur: Anti-Stuck Loading & Clean UI
]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")

-- 1. BERSIHKAN SCRIPT LAMA
if _G.FahriScriptActive then
    _G.FahriScriptActive = false
    task.wait(0.2)
end
if CoreGui:FindFirstChild("FahriPremiumUI_V2") then
    CoreGui.FahriPremiumUI_V2:Destroy()
end

-- 2. LOAD DATA
local success, GiftingController = pcall(function()
    return require(ReplicatedStorage:WaitForChild("Controllers"):WaitForChild("GiftingController"))
end)

if not success then
    game.StarterGui:SetCore("SendNotification", {Title="Error"; Text="Tunggu game loading 100%!"; Duration=5;})
    return
end

-- 3. BUAT UI KEREN
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local UIGradient = Instance.new("UIGradient")
local Title = Instance.new("TextLabel")
local SubTitle = Instance.new("TextLabel")
local ToggleBtn = Instance.new("TextButton")
local CleanBtn = Instance.new("TextButton") -- Tombol Baru: Fix Layar
local BtnCorner = Instance.new("UICorner")
local CleanCorner = Instance.new("UICorner")
local CloseBtn = Instance.new("TextButton")

ScreenGui.Name = "FahriPremiumUI_V2"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false

-- Frame Utama (Biru Gelap Modern)
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 25, 40)
MainFrame.Position = UDim2.new(0.5, 0, 0.4, 0)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.Size = UDim2.new(0, 0, 0, 0) -- Animasi Start
MainFrame.ClipsDescendants = true
MainFrame.Active = true
MainFrame.Draggable = true

UICorner.CornerRadius = UDim.new(0, 15)
UICorner.Parent = MainFrame

UIGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0.00, Color3.fromRGB(35, 40, 60)),
    ColorSequenceKeypoint.new(1.00, Color3.fromRGB(15, 20, 30))
}
UIGradient.Rotation = 45
UIGradient.Parent = MainFrame

-- Judul
Title.Parent = MainFrame
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 0, 0.08, 0)
Title.Size = UDim2.new(1, 0, 0, 25)
Title.Font = Enum.Font.GothamBlack
Title.Text = "AUTO SOUL SCYTHE"
Title.TextColor3 = Color3.fromRGB(0, 255, 220) -- Cyan Neon
Title.TextSize = 18

SubTitle.Parent = MainFrame
SubTitle.BackgroundTransparency = 1
SubTitle.Position = UDim2.new(0, 0, 0.8, 0)
SubTitle.Size = UDim2.new(1, 0, 0, 20)
SubTitle.Font = Enum.Font.GothamMedium
SubTitle.Text = "Dev: Fahri/xenavenezue"
SubTitle.TextColor3 = Color3.fromRGB(150, 150, 180)
SubTitle.TextSize = 11

-- Tombol Toggle (START/STOP)
ToggleBtn.Parent = MainFrame
ToggleBtn.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
ToggleBtn.Position = UDim2.new(0.1, 0, 0.3, 0)
ToggleBtn.Size = UDim2.new(0.55, 0, 0.35, 0)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.Text = "OFF"
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.TextSize = 16
BtnCorner.CornerRadius = UDim.new(0, 10)
BtnCorner.Parent = ToggleBtn

-- Tombol HAPUS UI (Ikon Sapu)
CleanBtn.Parent = MainFrame
CleanBtn.BackgroundColor3 = Color3.fromRGB(255, 150, 0) -- Orange
CleanBtn.Position = UDim2.new(0.7, 0, 0.3, 0)
CleanBtn.Size = UDim2.new(0.2, 0, 0.35, 0)
CleanBtn.Font = Enum.Font.GothamBold
CleanBtn.Text = "ðŸ§¹" -- Emoticon Sapu
CleanBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CleanBtn.TextSize = 20
CleanCorner.CornerRadius = UDim.new(0, 10)
CleanCorner.Parent = CleanBtn

-- Tombol Close (X)
CloseBtn.Parent = MainFrame
CloseBtn.BackgroundTransparency = 1
CloseBtn.Position = UDim2.new(0.88, 0, 0.05, 0)
CloseBtn.Size = UDim2.new(0, 25, 0, 25)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "X"
CloseBtn.TextColor3 = Color3.fromRGB(180, 180, 180)
CloseBtn.TextSize = 14

-- ANIMASI BUKA MENU
TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = UDim2.new(0, 260, 0, 140)}):Play()

-- 4. LOGIC SCRIPT
_G.FahriScriptActive = false
local isRunning = false

-- Fungsi untuk Update Warna Tombol
local function updateBtn(state)
    if state then
        ToggleBtn.Text = "RUNNING..."
        TweenService:Create(ToggleBtn, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(0, 200, 120)}):Play()
    else
        ToggleBtn.Text = "OFF"
        TweenService:Create(ToggleBtn, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(255, 60, 60)}):Play()
    end
end

ToggleBtn.MouseButton1Click:Connect(function()
    isRunning = not isRunning
    _G.FahriScriptActive = isRunning
    updateBtn(isRunning)

    if isRunning then
        task.spawn(function()
            while _G.FahriScriptActive do
                task.spawn(function()
                    pcall(function()
                        GiftingController:Open("Soul Scythe")
                    end)
                end)
                -- SAYA UBAH DELAY JADI 0.25 AGAR TIDAK TERLALU LAGGY
                task.wait(0.25) 
            end
        end)
    end
end)

-- FITUR PEMBERSIH LAYAR (Hapus UI Game yang Stuck)
CleanBtn.MouseButton1Click:Connect(function()
    pcall(function()
        local pg = Players.LocalPlayer.PlayerGui
        -- Mencari GUI game yang namanya mengandung 'Gift' atau 'Reward'
        for _, v in pairs(pg:GetChildren()) do
            if v:IsA("ScreenGui") and v.Enabled then
                -- Cek apakah ini GUI hadiah
                if v.Name:match("Gift") or v.Name:match("Reward") or v:FindFirstChild("Frame") then
                   -- Kita tidak delete, tapi sembunyikan saja biar aman
                   -- Kalau kamu merasa terganggu, klik tombol sapu ini
                   v.Enabled = false 
                end
            end
        end
        game.StarterGui:SetCore("SendNotification", {Title="UI Dibersihkan"; Text="Coba cek layar kamu sekarang."; Duration=3;})
    end)
end)

CloseBtn.MouseButton1Click:Connect(function()
    _G.FahriScriptActive = false
    isRunning = false
    TweenService:Create(MainFrame, TweenInfo.new(0.3), {Size = UDim2.new(0,0,0,0)}):Play()
    task.wait(0.3)
    ScreenGui:Destroy()
end)
